<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

	<!-- Basic Page Needs
  ================================================== -->
	<meta charset="utf-8">
	<meta name="author" content="Simon Weber">
    
    <meta name="description" content="How to get the Python protobuf package working on App Engine." />
    
	<link href="http://feeds.feedburner.com/SimonWeber" rel="alternate" title="Simon Weber" type="application/atom+xml" />
	<title>Python protobuf on Google App Engine</title>

	<!-- Mobile Specific Metas
  ================================================== -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, user-scalable=1">

	<!-- CSS
  ================================================== -->
	<link rel="stylesheet" href="/stylesheets/base.css">
	<link rel="stylesheet" href="/stylesheets/skeleton.css">
	<link rel="stylesheet" href="/stylesheets/layout.css">

	<link rel="stylesheet" href="/stylesheets/custom.css">
	<link rel="stylesheet" href="/stylesheets/pygments.css">

	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Favicons
	================================================== -->
	<link rel="shortcut icon" href="/images/favicon.ico">
	<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png">

</head>
<body>



    <!-- Primary Page Layout
    ================================================== -->
    <div class="container">
        <div class="four columns sidebar">
            <ul>
                <li><h3 id="logo"><a href="/index.html">Simon Weber</a></h3></li>
                <li><a href="mailto:simon@simonmweber.com">simon@simonmweber.com</a></li>
                <li>

                <div class="favicon five-spaced row">
                    <span><a href="https://github.com/simon-weber"><img alt="simon-weber" src="/images/github.ico"></a></span>
                    <span><a href="http://www.facebook.com/simon.weber1"> <img alt="simon.weber1" src="/images/facebook.ico"></a></span>
                    <span><a href="https://plus.google.com/103350848301234480355"> <img alt="Simon Weber" src="/images/plus.ico"></a></span>
		  <span><a href="http://news.ycombinator.com/user?id=simon_weber"> <img alt="simon_weber" src="/images/hn.ico"></a></span>
          <span><a href="https://twitter.com/#!/simonmweber"> <img alt="simonmweber" src="/images/twitter.ico"></a></span>
      </div>
      </li>
  </ul>

	    &nbsp;
    </div>

	  
    <div class="eleven columns offset-by-one content">
        <div id="post">
    <h2 id='python_protobuf_on_google_app_engine'>Python protobuf on Google App Engine</h2>
<p class='meta'>June 18 2013</p>
<p>Today, if you try to use Google Protocol Buffers on App Engine, you&#8217;ll run into an error like this one:</p>
<div class='highlight'><pre><code class='python'><span class='kn'>from</span> <span class='nn'>google.protobuf</span> <span class='kn'>import</span> <span class='n'>descriptor</span> 
<span class='ne'>ImportError</span><span class='p'>:</span> <span class='n'>No</span> <span class='n'>module</span> <span class='n'>named</span> <span class='n'>protobuf</span>
</code></pre></div>
<p>The problem is that Google&#8217;s own App Engine apis also use the <code>google</code> package namespace, and they don&#8217;t include the protobuf package.</p>

<p>Thankfully, there&#8217;s a simple way to fix this. First, vendorize the library as you normally would. I just ripped the <code>site-packages</code> folder from a virtualenv into the application root:</p>
<div class='highlight'><pre><code class='bash'>app.py
app.yaml
vendor
├── google
│   └── protobuf...
└── httplib2...
</code></pre></div>
<p>Then, just add your google directory to the google namespace, and add your vendor directory to the system path. I used this bit of code:</p>
<div class='highlight'><pre><code class='python'><span class='kn'>import</span> <span class='nn'>os</span>
<span class='kn'>import</span> <span class='nn'>sys</span>

<span class='kn'>import</span> <span class='nn'>google</span>  <span class='c'># provided by GAE</span>

<span class='c'># add vendorized protobuf to google namespace package</span>
<span class='n'>vendor_dir</span> <span class='o'>=</span> <span class='n'>os</span><span class='o'>.</span><span class='n'>path</span><span class='o'>.</span><span class='n'>join</span><span class='p'>(</span><span class='n'>os</span><span class='o'>.</span><span class='n'>path</span><span class='o'>.</span><span class='n'>dirname</span><span class='p'>(</span><span class='n'>__file__</span><span class='p'>),</span> <span class='s'>&#39;vendor&#39;</span><span class='p'>)</span>
<span class='n'>google</span><span class='o'>.</span><span class='n'>__path__</span><span class='o'>.</span><span class='n'>append</span><span class='p'>(</span><span class='n'>os</span><span class='o'>.</span><span class='n'>path</span><span class='o'>.</span><span class='n'>join</span><span class='p'>(</span><span class='n'>vendor_dir</span><span class='p'>,</span> <span class='s'>&#39;google&#39;</span><span class='p'>))</span>

<span class='c'># add vendor path</span>
<span class='n'>sys</span><span class='o'>.</span><span class='n'>path</span><span class='o'>.</span><span class='n'>insert</span><span class='p'>(</span><span class='mi'>0</span><span class='p'>,</span> <span class='n'>vendor_dir</span><span class='p'>)</span>
</code></pre></div>
<p>That&#8217;s it! There&#8217;s no need for <a href='https://code.google.com/p/protobuf-gae-hack'>weird hacks</a>.</p>
</div>

<div id="post-footer">
    <hr>
    <div id="subscribe">
        <p>
        <a href="http://feeds.feedburner.com/SimonWeber"><img src="/images/rss.png" alt="Subscribe to RSS Feed" /></a>
        </p>
    </div>
</div>

    </div>
</div><!-- container -->



	<!-- JS
	     ================================================== -->
	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
	<script src="/javascripts/tabs.js"></script>
	<script type="text/javascript">

	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-29570993-2']);
	  _gaq.push(['_trackPageview']);

	  (function() {
	  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

	</script>

<!-- End Document
================================================== -->
</body>
</html>
